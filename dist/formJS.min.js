/*
 * Copyright (c) 2018.  JAGFx
 * @author: SMITH Emmanuel
 * @version: 2.0.0
 */

!function(t){t.fn.formJS=function(e){var a=t.extend({alerts:{unexpected:{title:"Error",message:"Unexpected error occurred"},failSend:{title:"Error",message:"Unable to send data"}},keys:{success:"success",info:"info",warning:"warning",error:"danger"},icons:{loading:'<span class="fas fa-circle-notch fa-spin"></span>',success:'<span class="fas fa-check"></span>',info:'<span class="fas fa-info"></span>',warning:'<span class="fas fa-exclamation-triangle"></span>',error:'<span class="fas fa-fire"></span>'},form:{ajaxSettings:{contentType:!1},alertContainer:".formJS"},redirection:{message:"Automatic redirection in a second",delay:1100},btnSubmit:'.btn[type="submit"]',callback:function(){}},e);return this.each(function(){var e,n,r,s=t(this),i=s.attr("action"),o=s.attr("method"),l=s.find(a.btnSubmit),c=t.extend(a.alerts.unexpected,{type:"error"}),d=!1;s.submit(function(f){if(f.preventDefault(),!1===d){d=!0;try{if(0===l.length)throw"Unable to find submit button";if(l.append(t(a.icons.loading).addClass("formJS-loading")).attr("disabled"),l.addClass("disabled"),""==o||null==o)throw"Undefined method of form";e=window.FormData?new FormData(s[0]):null,n=null!==e?e:s.serialize(),r=t.extend(a.form.ajaxSettings,{url:i,type:o,data:n,processData:!1}),t.ajax(r).done(function(e){try{if(0===e.length)throw"No data found on response";var n=t.parseJSON(e),r="";s.checkFeedbackStructure(n),n.type===a.keys.success&&n.hasOwnProperty("url")&&(r=" - "+a.redirection.message,setTimeout(function(){window.location.replace(n.url)},a.redirection.delay)),c.type=n.type,c.title=n.data.title,c.message=n.data.message+r}catch(t){console.error("[FormJS] "+t)}}).fail(function(t){console.error(t)}).always(function(){s.writeAlert()})}catch(t){console.error("[FormJS] "+t),s.writeAlert()}}}),s.checkFeedbackStructure=function(t){if(!t.hasOwnProperty("type"))throw'Invalid feedback structure: "type" missing';if(!t.hasOwnProperty("data"))throw'Invalid feedback structure: "data" missing';if(!t.data.hasOwnProperty("title"))throw'Invalid feedback structure: "data.title" missing';if(!t.data.hasOwnProperty("message"))throw'Invalid feedback structure: "data.message" missing';if(-1===Object.keys(a.keys).indexOf(t.type))throw'Invalid feedback structure: "type" wrong. Accepted values: '+Object.keys(a.keys).toString()},s.writeAlert=function(){var e=t('<div class="alert formjs-'+c.type+'" role="alert" />').html('<div class="ico">\n\t\t\t\t\t\t\t\t'+a.icons[c.type]+'\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="info">\n\t\t\t\t\t\t\t\t<h4>'+c.title+"</h4>\n\t\t\t\t\t\t\t\t<p>"+c.message+"</p>\n\t\t\t\t\t\t\t</div>").hide().fadeIn(300);t(a.form.alertContainer).empty().html(e),t("html, body").animate({scrollTop:t(a.form.alertContainer).offset().top-55},300);var n=t(a.btnSubmit);void 0!==n&&n.length&&(n.find(".formJS-loading").remove(),n.removeClass("disabled"),d=!1),c.type===a.keys.success||c.type===a.keys.info?console.log(c.title+" - "+c.message):c.type===a.keys.error?console.error(c.title+" - "+c.message):c.type===a.keys.warning?console.warn(c.title+" - "+c.message):console.log(c.title+" - "+c.message),a.callback()},s.init=function(){if(0===s.find(a.form.alertContainer).length){var e=t("<div/>"),n=a.form.alertContainer.split("."),r=e,i="",o="";t.each(n,function(t,e){e.indexOf("#")>=0?i+=e.replace(/^#/,""):o+=e+" "}),i.length&&r.attr("id",i),o.length&&r.attr("class",o.trim()),s.prepend(r)}},s.init()}),this},t.fn.setDisplayForm=function(){var e=t(window).width()<=768?"block":"flex";return t(this).css("display",e),this}}(jQuery),$(window).resize(function(){$("form .messageForm .alert").setDisplayForm()});